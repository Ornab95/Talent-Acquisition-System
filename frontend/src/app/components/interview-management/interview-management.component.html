<div [class]="isDarkMode ? 'interview-management dark-theme' : 'interview-management'">
  <div class="header">
    <h3>Interviews</h3>
    <button (click)="openScheduleForm()" [class]="isDarkMode ? 'btn btn-primary-dark' : 'btn btn-primary'">
      <i class="fas fa-calendar-plus"></i> Schedule Interview
    </button>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="alert alert-error">{{ error }}</div>

  <!-- Interviews List -->
  <div class="interviews-list">
    <div *ngIf="interviews.length === 0" class="no-interviews">
      No interviews scheduled yet.
    </div>

    <div *ngFor="let interview of interviews" class="interview-card">
      <div class="interview-header">
        <div class="interview-info">
          <h4>üë§ {{ interview.interviewer.firstName }} {{ interview.interviewer.lastName }}</h4>
          <div style="display: flex; gap: 8px; margin-top: 8px;">
            <span class="interview-type">üìπ {{ interview.interviewType }}</span>
            <span class="interview-status" [class]="'status-' + interview.status.toLowerCase()">
              {{ interview.status === 'SCHEDULED' ? '‚úÖ' : interview.status === 'COMPLETED' ? '‚úîÔ∏è' : '‚ùå' }} {{ interview.status }}
            </span>
          </div>
        </div>
        <div class="interview-actions">
          <button *ngIf="interview.status === 'SCHEDULED'" (click)="openFeedbackModal(interview)"
            [class]="isDarkMode ? 'btn btn-sm btn-secondary' : 'btn btn-sm btn-secondary'"
            style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">
            <i class="fas fa-comment-dots"></i> Add Feedback
          </button>
          <button *ngIf="interview.status === 'SCHEDULED'" (click)="updateStatus(interview, 'CANCELED')"
            class="btn btn-sm btn-danger">
            <i class="fas fa-times-circle"></i> Cancel
          </button>
        </div>
      </div>

      <div class="interview-details">
        <p><i class="fas fa-clock"></i> <strong>{{ formatDate(interview.scheduledAt) }}</strong></p>
        <p *ngIf="interview.meetingLink">
          <i class="fas fa-video"></i>
          <a [href]="interview.meetingLink" target="_blank" style="color: #3b82f6; font-weight: 600; text-decoration: underline;">Join Meeting Link</a>
        </p>
      </div>
      
      <div *ngIf="interview.feedback" class="feedback">
        <i class="fas fa-comment-alt"></i> <strong>Feedback:</strong> {{ interview.feedback }}
      </div>
    </div>
  </div>

  <!-- Schedule Interview Modal -->
  <div *ngIf="showScheduleForm" class="fixed inset-0 backdrop-blur-sm flex items-start justify-center z-[10000] p-4 pt-20 pb-12"
       (click)="closeScheduleForm()">
    <div [class]="isDarkMode 
      ? 'bg-gray-800 p-8 rounded-3xl w-full max-w-2xl max-h-[85vh] overflow-y-auto shadow-2xl border border-gray-700 mb-8' 
      : 'bg-purple-50 p-8 rounded-3xl w-full max-w-2xl max-h-[85vh] overflow-y-auto shadow-2xl border border-purple-300 mb-8'"
         (click)="$event.stopPropagation()">
      
      <!-- Header -->
      <div class="flex items-center justify-between mb-8">
        <div class="flex items-center space-x-3">
          <div [class]="isDarkMode 
            ? 'w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center' 
            : 'w-12 h-12 bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl flex items-center justify-center'">
            <i class="fas fa-calendar-plus text-white text-xl"></i>
          </div>
          <h3 [class]="isDarkMode 
            ? 'text-3xl font-bold text-white' 
            : 'text-3xl font-bold text-purple-900'">Schedule Interview</h3>
        </div>
        <button (click)="closeScheduleForm()" 
          [class]="isDarkMode 
            ? 'text-gray-400 hover:text-white text-2xl w-10 h-10 rounded-full hover:bg-gray-700 flex items-center justify-center transition-all' 
            : 'text-gray-500 hover:text-gray-700 text-2xl w-10 h-10 rounded-full hover:bg-gray-100 flex items-center justify-center transition-all'">
          &times;
        </button>
      </div>

      <form (ngSubmit)="scheduleInterview()" class="space-y-6">
        <!-- Interviewer -->
        <div class="relative">
          <label [class]="isDarkMode 
            ? 'block text-sm font-semibold text-gray-300 mb-3 flex items-center' 
            : 'block text-sm font-semibold text-gray-700 mb-3 flex items-center'">
            <i class="fas fa-user mr-2 text-purple-500"></i>
            Interviewer
          </label>
          <div [class]="isDarkMode 
            ? 'w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-xl text-gray-400 flex items-center' 
            : 'w-full p-4 bg-gray-50 border-2 border-gray-200 rounded-xl text-gray-600 flex items-center'">
            <i class="fas fa-user mr-2"></i>
            {{ getCurrentUserName() }}
          </div>
          <input type="hidden" [(ngModel)]="scheduleForm.interviewerId" name="interviewer">
        </div>

        <!-- Interview Type -->
        <div class="relative">
          <label [class]="isDarkMode 
            ? 'block text-sm font-semibold text-gray-300 mb-3 flex items-center' 
            : 'block text-sm font-semibold text-gray-700 mb-3 flex items-center'">
            <i class="fas fa-video mr-2 text-blue-500"></i>
            Interview Type *
          </label>
          <select [(ngModel)]="scheduleForm.interviewType" name="type" required
            [class]="isDarkMode 
              ? 'w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all' 
              : 'w-full p-4 bg-white border-2 border-purple-300 rounded-xl text-gray-900 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all'">
            <option value="PHONE">üìû Phone Interview</option>
            <option value="VIDEO">üé• Video Interview</option>
            <option value="ONSITE">üè¢ On-site Interview</option>
          </select>
        </div>

        <!-- Interview Date & Time -->
        <div class="relative">
          <label [class]="isDarkMode 
            ? 'block text-sm font-semibold text-gray-300 mb-3 flex items-center' 
            : 'block text-sm font-semibold text-gray-700 mb-3 flex items-center'">
            <i class="fas fa-calendar-alt mr-2 text-orange-500"></i>
            Interview Date & Time *
          </label>
          <input #dateTimeInput
                 type="datetime-local" 
                 [(ngModel)]="scheduleForm.scheduledAt" 
                 name="scheduledAt" 
                 required
                 [min]="getCurrentDateTime()"
                 (click)="dateTimeInput.showPicker()"
                 [class]="isDarkMode 
                   ? 'w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all cursor-pointer' 
                   : 'w-full p-4 bg-white border-2 border-purple-300 rounded-xl text-gray-900 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all cursor-pointer'">
        </div>

        <!-- Meeting Link -->
        <div class="relative" *ngIf="scheduleForm.interviewType === 'VIDEO'">
          <label [class]="isDarkMode 
            ? 'block text-sm font-semibold text-gray-300 mb-3 flex items-center' 
            : 'block text-sm font-semibold text-gray-700 mb-3 flex items-center'">
            <i class="fas fa-link mr-2 text-green-500"></i>
            Meeting Link
          </label>
          <input type="url" [(ngModel)]="scheduleForm.meetingLink" name="link" placeholder="https://meet.google.com/..."
            [class]="isDarkMode 
              ? 'w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all' 
              : 'w-full p-4 bg-white border-2 border-purple-300 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all'">
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end space-x-4 pt-6 border-t" [class]="isDarkMode ? 'border-gray-700' : 'border-gray-200'">
          <button type="button" (click)="closeScheduleForm()" 
            [class]="isDarkMode 
              ? 'px-8 py-4 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2' 
              : 'px-8 py-4 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2'">
            <i class="fas fa-times"></i>
            <span>Cancel</span>
          </button>
          <button type="submit" [disabled]="loading"
            class="px-8 py-4 bg-purple-500 hover:bg-purple-600 text-white rounded-xl font-bold transition-all duration-300 flex items-center space-x-2 shadow-xl hover:shadow-2xl transform hover:scale-105 hover:-translate-y-1">
            <i [class]="loading ? 'fas fa-spinner fa-spin text-lg' : 'fas fa-calendar-check text-lg'"></i>
            <span>{{ loading ? 'Scheduling...' : 'Schedule Interview' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div *ngIf="showFeedbackModal" class="modal-overlay" (click)="closeFeedbackModal()">
    <div [class]="isDarkMode ? 'modal-content dark-modal' : 'modal-content'" (click)="$event.stopPropagation()">
      <div [class]="isDarkMode ? 'modal-header dark-header' : 'modal-header'">
        <div class="flex items-center space-x-3">
          <div [class]="isDarkMode ? 'w-12 h-12 bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl flex items-center justify-center' : 'w-12 h-12 bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl flex items-center justify-center'">
            <i class="fas fa-comment-dots text-white text-xl"></i>
          </div>
          <h3 [class]="isDarkMode ? 'text-2xl font-bold text-white' : 'text-2xl font-bold text-gray-900'">Interview Feedback</h3>
        </div>
        <button (click)="closeFeedbackModal()" [class]="isDarkMode ? 'close-btn dark-close' : 'close-btn'">&times;</button>
      </div>

      <form (ngSubmit)="submitFeedback()" class="feedback-form">
        <div class="form-group">
          <label [class]="isDarkMode ? 'text-gray-300 font-semibold flex items-center' : 'text-gray-700 font-semibold flex items-center'">
            <i class="fas fa-comment-alt mr-2 text-purple-500"></i>
            Feedback *
          </label>
          <textarea [(ngModel)]="feedbackText" name="feedback" rows="6"
            placeholder="Enter your interview feedback here..."
            required
            [class]="isDarkMode ? 'w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-xl text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all resize-none' : 'w-full p-4 bg-white border-2 border-purple-300 rounded-xl text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all resize-none'"></textarea>
        </div>

        <div [class]="isDarkMode ? 'modal-actions dark-actions' : 'modal-actions'">
          <button type="button" (click)="closeFeedbackModal()" 
            [class]="isDarkMode ? 'px-8 py-4 bg-gray-600 hover:bg-gray-700 text-white rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2' : 'px-8 py-4 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl font-semibold transition-all duration-200 flex items-center space-x-2'">
            <i class="fas fa-times"></i>
            <span>Cancel</span>
          </button>
          <button type="submit" [disabled]="loading" 
            class="px-8 py-4 bg-purple-500 hover:bg-purple-600 text-white rounded-xl font-bold transition-all duration-300 flex items-center space-x-2 shadow-xl hover:shadow-2xl transform hover:scale-105 hover:-translate-y-1">
            <i [class]="loading ? 'fas fa-spinner fa-spin text-lg' : 'fas fa-save text-lg'"></i>
            <span>{{ loading ? 'Saving...' : 'Save Feedback' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>